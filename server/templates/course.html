{% import 'macros.html' as macros %}

{% call macros.us_template('course-tpl') %}
{# TODO(mack): remove uc.term_id null checks #}
<% if (mode === 'add') { %>
  <div class="shortlist-btn add-course-btn">
    <div class="shortlist-btn-inner">
      <i class="icon-plus"></i>
    </div>
  </div>
<% } else if (mode === 'remove') { %>
  <div class="shortlist-btn remove-course-btn">
    <div class="shortlist-btn-inner">
      <i class="icon-remove"></i>
    </div>
  </div>
<% } %>
<div class="course-content">
  <div class="visible-section">
    <div class="course-code">
      <span class="course-code-unlinked"><%- course.code %></span>
      <a href="/course/<%- course.id %>" class="course-code-linked">
        <%- course.code %>
      </a>
    </div>
    <div class="course-name"><%- course.name %></div>

    <div class="rating-box-placeholder"></div>
    <div class="voting-placeholder"></div>
    <div class="sample-friends-placeholder"></div>

    {# TODO(david): Separate this out into its own view+model #}
    <% if (profile_user_course && profile_user_course.hasTaken()) { %>
      <div class="sash">
        {# Using HTML entities instead of CSS pseudo-elements because
        transitions are broken for them on Chrome #}
        <span title="Rate this course to earn this star." class="badge-holder">
          <i class="rated-course <%- profile_user_course.hasRatedCourse() ? 'done' : '' %>">&#xf005;</i>
        </span>
        <span title="Review this course to earn this star." class="badge-holder">
          <i class="reviewed-course <%- profile_user_course.hasReviewedCourse() ? 'done' : '' %>">&#xf005;</i>
        </span>
        <br>
        <span title="Rate the prof to earn this star." class="badge-holder">
          <i class="rated-prof <%- profile_user_course.hasRatedProf() ? 'done' : '' %>">&#xf005;</i>
        </span>
        <span title="Review the prof to earn this star." class="badge-holder">
          <i class="reviewed-prof <%- profile_user_course.hasReviewedProf() ? 'done' : '' %>">&#xf005;</i>
        </span>
      </div>
    <% } %>

    {# TODO(david): This is really dumb. Fix in a better way. #}
    <div style="clear: both; margin-bottom: -32px;"></div>
  </div>
  <div class="course-inner-placeholder"></div>
</div>
{% endcall %}

{% call macros.us_template('sample-friends-tpl') %}
<div class="friend-collection-placeholder"></div>
<% var remaining = Math.max(num_friends - max_sample_friends, 0); %>
<% if (remaining > 0) { %>
  <a href="#" rel="popover" class="remaining-friends">
    + <%- remaining %> other <%- pluralize(remaining, 'friend', 'friends') %>
  </a>
<% } %>

{% endcall %}

{% call macros.us_template('course-inner-tpl') %}
<div class="row-fluid">
  <div class="span6 left-col">
    <p class="description"><%- course.get('description') %></p>
    <% if (course.has('prereqs')) { %>
      <p class="prereqs">
        <strong>Prereqs:</strong>
        <%= course.getReqsHtml(course.get('prereqs')) %>
      </p>
    <% } %>
    <% if (course.get('terms_offered').length) { %>
      <div class="terms-offered">
        <%
          var offered = function(term) {
            var offered_in_term = _.any(course.get('terms_offered'), function(term_offered) {
              return term === term_offered;
            });

            if (offered_in_term) {
              return 'offered';
            }
            return '';
          };
        %>
        <span class="label fall <%- offered('09') %>">Fall</span>
        <span class="label winter <%- offered('01') %>">Winter</span>
        <span class="label spring <%- offered('05') %>">Spring</span>
      </div>
    <% } %>
  </div>
  <div class="span6 right-col">
    <div class="ratings-placeholder"></div>
  </div>
</div>

<% if (can_review) { %>
  <div class="row-fluid review-box-row">
    <div class="span12">
      <div class="user-review-box">
        <div class="review-placeholder"></div>
      </div>
    </div>
  </div>
<% } %>

<div class="row-fluid more-info">
  <div class="span12">
    <% if (more_details) { %>
      {# See what your friends are saying about <%- course.code %>! #}
      {# TODO(david): Wrap with <li>s #}
      <a href="/course/<%- course.id %>">
        <i class="icon-info-sign"></i> More Info</a>
    <% } %>

    <% if (mode === 'add') { %>
      <a class="add-course-btn">
        <i class="icon-plus-sign"></i> Add to shortlist</a>
    <% } else if (mode === 'remove') { %>
      <a class="remove-course-btn">
        <i class="icon-remove-sign"></i> Remove from profile</a>
    <% } %>
  </div>
</div>
{% endcall %}

{% call macros.us_template('course-friends-hovercard-tpl') %}
{% endcall %}

{% call macros.us_template('course-friend-tpl') %}
{# TODO(mack): remove harcode by storing attributes in User rather than
  stashing in UserCourse #}
<a href="<%- friend.profile_url %>">
  <img class="friend-pic-img"
    src="<%- friend.fb_pic_url %>">
</a>
{% endcall %}

{% call macros.us_template('course-confirm-remove-dialog-tpl') %}
<div class="modal hide-initial fade" id="confirm-remove-modal" tabindex="-1"
    role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3 id="myModalLabel">Remove <%- course_code %> from profile</h3>
  </div>
  <div class="modal-body">
    <p>
      Your ratings and reviews for <%- course_code %> will also be removed. Are
      you sure?
    </p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-danger" data-dismiss="modal"
        id="confirm-remove-modal-button-yes">
      <i class="icon-trash"></i>
      Yes, remove it!
    </button>
    <button class="btn" data-dismiss="modal"
        id="confirm-remove-modal-button-no">
      No, don&apos;t remove it!
    </button>
  </div>
</div>
{% endcall %}
