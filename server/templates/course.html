{% import 'macros.html' as macros %}

{% call macros.us_template('course-tpl') %}
{# TODO(mack): remove uc.term_id null checks #}
<%
var mode;
if (other_profile) {
  if (!user_course || !user_course.term_id) {
    mode = 'add';
  }
} else {
  if (user_course && user_course.term_id) {
    mode = 'remove';
  } else {
    mode = 'add';
  }
}
%>
<% if (mode === 'add') { %>
  <div class="shortlist-btn add-course-btn">
    <div class="shortlist-btn-inner">
      <i class="icon-plus"></i>
    </div>
  </div>
<% } else if (mode === 'remove') { %>
  <div class="shortlist-btn remove-course-btn">
    <div class="shortlist-btn-inner">
      <i class="icon-remove"></i>
    </div>
  </div>
<% } %>
<div class="course-content well">
  <div class="visible-section">
    <a href="/course/<%- course.id %>" class="course-code" title="Go to course details page">
      <%- course.code %>
    </a>
    <div class="course-name"><%- course.name %></div>
    <div class="ribbons">
      {# TODO(mack): clean up the following line #}
      <% if (user_course && user_course.term_id) { %>
        <div class="current-user-ribbon reviewed-<%- user_course_review_level %>">
          <i class="icon-pencil"></i>
        </div>
      <% } %>
      <% if (other_profile && profile_user_course && profile_user_course.term_id) { %>
      <div class="profile-user-ribbon reviewed-<%- profile_user_course_review_level %>">
        <i class="icon-pencil"></i>
      </div>
      <% } %>
    </div>
    <div class="rating-box-placeholder"></div>
    <div class="voting-placeholder"></div>
    <div class="sample-friends-placeholder"></div>
    {# TODO(david): This is really dumb. Fix in a better way. #}
    <div style="clear: both; margin-bottom: -25px;"></div>
  </div>
  <div class="course-inner-placeholder"></div>
</div>
{% endcall %}

{% call macros.us_template('sample-friends-tpl') %}
<div class="friend-collection-placeholder"></div>
<% var remaining = Math.max(num_friends - max_sample_friends, 0); %>
<% if (remaining > 0) { %>
  <a href="#" rel="popover" class="remaining-friends">
    + <%- remaining %> other <%- pluralize(remaining, 'friend', 'friends') %>
  </a>
<% } %>

{% endcall %}

{% call macros.us_template('course-inner-tpl') %}
<div class="row-fluid">
  <div class="span6">
    <p class="description"><%- course.description %></p>
    <% if (course.terms_offered.length) { %>
      <div class="terms-offered">
        <%
          var offered = function(term) {
            var offered_in_term = _.any(course.terms_offered, function(term_offered) {
              return term === term_offered;
            });

            if (offered_in_term) {
              return 'offered';
            }
            return '';
          };
        %>
        <span class="label fall <%- offered('09') %>">Fall</span>
        <span class="label winter <%- offered('01') %>">Winter</span>
        <span class="label spring <%- offered('05') %>">Spring</span>
      </div>
    <% } %>
  </div>
  <div class="span6">
    <div class="ratings-placeholder"></div>
  </div>
</div>

<% if (can_review) { %>
  <div class="row-fluid">
    <div class="span12">
      <div class="alert alert-info user-review-box">
        <div class="review-placeholder"></div>
      </div>
    </div>
  </div>
<% } %>

<% if (more_details) { %>
  <div class="row-fluid">
    <div class="span12 more-info">
      <a href="/course/<%- course.id %>">
        See what your friends are saying about <%- course.code %>!
      </a>
    </div>
  </div>
<% } %>
{% endcall %}

{% call macros.us_template('course-friends-hovercard-tpl') %}
{% endcall %}

{% call macros.us_template('course-friend-tpl') %}
{# TODO(mack): remove harcode by storing attributes in User rather than
  stashing in UserCourse #}
<a href="<%- friend.profile_url %>">
  <img class="friend-pic-img img-rounded"
    src="<%- friend.fb_pic_url %>">
</a>
{% endcall %}

{% call macros.us_template('course-confirm-remove-dialog-tpl') %}
<div class="modal hide-initial fade" id="confirm-remove-modal" tabindex="-1"
    role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3 id="myModalLabel">Remove <%- course_code %> from profile</h3>
  </div>
  <div class="modal-body">
    <p>
      Your ratings and reviews for <%- course_code %> will also be removed. Are
      you sure?
    </p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-danger" data-dismiss="modal"
        id="confirm-remove-modal-button-yes">
      <i class="icon-trash"></i>
      Yes, remove it!
    </button>
    <button class="btn" data-dismiss="modal"
        id="confirm-remove-modal-button-no">
      No, don&apos;t remove it!
    </button>
  </div>
</div>
{% endcall %}
